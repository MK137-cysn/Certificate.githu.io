<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luxury Certificate PRO - Stable Download</title>
    <link href="https://fonts.googleapis.com/css2?family=Siemreap&family=Cinzel:wght@700&family=Playball&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root { 
            --gold-grad: linear-gradient(135deg, #bd9354 0%, #ffde59 50%, #bd9354 100%);
            --navy: #0c1424;
            --gold-solid: #d4af37;
        }

        body { font-family: 'Siemreap', sans-serif; margin: 0; background: #111; color: #fff; }

        /* Navbar */
        .navbar { 
            background: #000; height: 50px; display: flex; align-items: center; 
            justify-content: space-between; padding: 0 15px; position: sticky; top: 0; z-index: 2000;
            border-bottom: 2px solid var(--gold-solid);
        }
        .menu-btn { background: var(--gold-grad); border: none; padding: 8px 16px; border-radius: 6px; font-weight: bold; cursor: pointer; color: #000; }

        /* Ads Popup */
        #adsPopup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; z-index: 5000; backdrop-filter: blur(8px); }
        .ads-content { background: #fff; color: #333; width: 90%; max-width: 400px; padding: 30px; border-radius: 20px; text-align: center; border: 3px solid var(--gold-solid); }
        .tg-link { display: block; background: #0088cc; color: white; text-decoration: none; padding: 12px; margin: 10px 0; border-radius: 10px; font-weight: bold; }
        .close-ads { background: var(--gold-grad); border: none; padding: 12px 40px; border-radius: 50px; font-weight: bold; cursor: pointer; margin-top: 20px; }

        /* Editor Panel (Responsive) */
        .overlay-editor { 
            position: fixed; top: 50px; left: -100%; width: 100%; height: calc(100% - 50px); 
            background: #fff; z-index: 1500; overflow-y: auto; transition: 0.4s; color: #333; padding: 25px; box-sizing: border-box; 
        }
        .overlay-editor.active { left: 0; }
        
        @media (min-width: 1000px) {
            .overlay-editor { width: 400px; left: -400px; border-right: 2px solid gold; }
            .overlay-editor.active { left: 0; }
        }

        .input-box { margin-bottom: 15px; }
        .input-box label { font-size: 13px; font-weight: bold; display: block; margin-bottom: 5px; color: var(--navy); }
        .input-box input, .input-box textarea { width: 100%; padding: 12px; border: 1.5px solid #ccc; border-radius: 10px; font-family: 'Siemreap'; box-sizing: border-box; }
        .btn-action { background: var(--navy); color: gold; width: 100%; padding: 15px; border: 1px solid gold; border-radius: 10px; font-weight: bold; cursor: pointer; margin-bottom: 12px; }

        /* Preview Area */
        .preview-area { display: flex; flex-direction: column; align-items: center; padding: 20px; width: 100%; box-sizing: border-box; }
        
        .cert-item { margin-bottom: 40px; display: flex; flex-direction: column; align-items: center; width: 100%; }
        
        /* Container á”á„áŸ’ášá½á˜áŸá˜áŸ’ášá¶á”áŸ‹á˜á¾á›á›á¾á¢áŸá€áŸ’ášá„áŸ‹ */
        .cert-container-resizer { 
            width: 100%; overflow: hidden; display: flex; justify-content: center;
        }

        .cert-wrapper { 
            transform-origin: top center;
            box-shadow: 0 20px 80px rgba(0,0,0,0.8);
            transform: scale(0.3); 
            width: 1123px; height: 794px;
            margin-bottom: -550px;
        }

        @media (min-width: 600px) { .cert-wrapper { transform: scale(0.5); margin-bottom: -380px; } }
        @media (min-width: 1000px) { .cert-wrapper { transform: scale(0.7); margin-bottom: -220px; } }

        /* --- Certificate Content Design --- */
        .cert-paper { 
            width: 1123px; height: 794px; background: var(--navy); 
            padding: 15px; box-sizing: border-box; 
            display: flex; align-items: center; justify-content: center;
        }
        .frame-2 { width: 100%; height: 100%; background: var(--gold-grad); padding: 8px; box-sizing: border-box; }
        .frame-3 { width: 100%; height: 100%; background: var(--navy); padding: 12px; box-sizing: border-box; }
        
        .cert-content { 
            width: 100%; height: 100%; background: #fffdf5; border: 3px solid var(--gold-solid);
            display: flex; flex-direction: column; align-items: center; justify-content: space-between; 
            padding: 70px 80px; box-sizing: border-box; position: relative;
        }

        .cert-title { font-family: 'Cinzel'; font-size: 110px; color: var(--navy); margin: 0; line-height: 1; }
        .deco-txt { color: var(--gold-solid); font-weight: bold; letter-spacing: 12px; font-size: 24px; font-family: 'Cinzel'; margin-top: 5px; }

        .student-name { font-family: 'Playball', cursive; color: var(--navy); border-bottom: 4px double var(--gold-solid); padding: 0 80px; font-size: 95px; margin: 30px 0; display: inline-block; white-space: nowrap; line-height: 1.2; }
        .desc { font-size: 26px; color: #333; max-width: 850px; text-align: center; line-height: 1.8; font-family: 'Siemreap'; }

        .footer { width: 100%; display: flex; justify-content: space-between; align-items: flex-end; padding: 0 40px; margin-bottom: 20px; }
        .sign-block { text-align: center; width: 350px; }
        .sign-name { font-weight: bold; font-size: 30px; color: var(--navy); line-height: 1.4; }
        .line { border-top: 2.5px solid var(--navy); width: 100%; margin-top: 10px; }
        .sign-label { font-size: 16px; color: #888; margin-top: 8px; letter-spacing: 2px; }
        
        .seal { position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); width: 130px; }
    </style>
</head>
<body>

    <div id="adsPopup">
        <div class="ads-content">
            <h2 style="margin:0 0 15px 0;">áŸá¼á˜á…á¼á›ášá½á˜á‡á¶á˜á½á™á™á¾á„</h2>
            <a href="https://t.me/Lesson_questions12" class="tg-link" target="_blank">ğŸ“¢ Lesson Questions</a>
            <a href="https://t.me/CHANNEL_QUIZ11" class="tg-link" target="_blank">ğŸ§  Channel Quiz</a>
            <a href="https://t.me/I_AM_RA2" class="tg-link" target="_blank">ğŸ‘¤ I AM RA2</a>
            <button class="close-ads" onclick="closeAds()">á™á›áŸ‹á–áŸ’ášá˜á”áŸ’ášá¾á”áŸ’ášá¶áŸáŸ‹</button>
        </div>
    </div>

    <div class="navbar">
        <button class="menu-btn" onclick="toggleMenu()">â˜° á€áŸ‚á¢ááŸ’áá”á‘</button>
        <div style="font-family: 'Cinzel'; color: gold; font-size: 12px; font-weight: bold;">PREMIUM CERTIFICATE</div>
        <div style="width: 20px;"></div>
    </div>

    <div class="overlay-editor" id="overlay">
        <h3 style="margin-top: 0;">á€áŸ‚áŸá˜áŸ’ášá½á›á–áŸááŸŒá˜á¶á“</h3>
        <div class="input-box"><label>áˆáŸ’á˜áŸ„áŸ‡áŸá·áŸáŸ’áŸ</label><input type="text" id="inName" placeholder="áˆáŸ’á˜áŸ„áŸ‡áŠáŸ‚á›ááŸ’ášá¼áœá”á„áŸ’á á¶á‰..." oninput="autoSave()"></div>
        <div class="input-box"><label>ááŸ’á›á¹á˜áŸá¶ášá¢ááŸ’áá”á‘</label><textarea id="inDesc" rows="3" oninput="autoSave()">áŸá˜áŸ’ášá¶á”áŸ‹á€á¶ášá”á‰áŸ’á…á”áŸ‹áœá‚áŸ’á‚áŸá·á€áŸ’áŸá¶ "á€á¶ášášá…á“á¶á‚áŸá á‘áŸ†á–áŸáš" áŠáŸ„á™á‡áŸ„á‚á‡áŸá™ á“á·á„á‘á‘á½á›á”á¶á“á“á·á‘áŸ’á‘áŸáŸá›áŸ’á¢á”áŸ’ášáŸá¾ášáŸ”</textarea></div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="input-box"><label>áˆáŸ’á˜áŸ„áŸ‡á”áŸ’ášá’á¶á“</label><input type="text" id="inMan" value="á›áŸ„á€ á áŸŠá¶á„ áŸá»á—áŸá€áŸ’ááŸ’áš" oninput="autoSave()"></div>
            <div class="input-box"><label>ááŸ’á„áŸƒ ááŸ‚ á†áŸ’á“á¶áŸ†</label><input type="text" id="inDate" value="ááŸ’á„áŸƒá‘á¸ áŸ áŸ§ ááŸ‚á€á»á˜áŸ’á—áŸˆ á†áŸ’á“á¶áŸ†áŸ¢áŸ áŸ¢áŸ¦" oninput="autoSave()"></div>
        </div>
        <button class="btn-action" onclick="addNewCert()">+ á”á„áŸ’á€á¾ááœá·á‰áŸ’á‰á¶á”á“á”áŸááŸ’áš</button>
        <button id="dlBtn" class="btn-action" style="background:var(--gold-grad); color:#000; border:none;" onclick="downloadAll()">á‘á¶á‰á™á€á‘á¶áŸ†á„á¢áŸáŸ‹ (HD PNG)</button>
        <button class="btn-action" style="background:#eee; color: #333;" onclick="toggleMenu()">á”á·á‘</button>
    </div>

    <div class="preview-area" id="certList"></div>

    <script>
        function toggleMenu() { document.getElementById('overlay').classList.toggle('active'); }
        function closeAds() { document.getElementById('adsPopup').style.display = 'none'; }

        function autoSave() {
            const data = {
                name: document.getElementById('inName').value,
                desc: document.getElementById('inDesc').value,
                man: document.getElementById('inMan').value,
                date: document.getElementById('inDate').value
            };
            localStorage.setItem('cert_ultimate_v1', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('cert_ultimate_v1');
            if (saved) {
                const d = JSON.parse(saved);
                document.getElementById('inName').value = d.name;
                document.getElementById('inDesc').value = d.desc;
                document.getElementById('inMan').value = d.man;
                document.getElementById('inDate').value = d.date;
            }
        }

        function addNewCert() {
            const name = document.getElementById('inName').value || "áˆáŸ’á˜áŸ„áŸ‡áŸá·áŸáŸ’áŸ";
            const desc = document.getElementById('inDesc').value;
            const man = document.getElementById('inMan').value;
            const date = document.getElementById('inDate').value;

            const html = `
                <div class="cert-item">
                    <button style="margin-bottom:15px; color:#fff; background:#e74c3c; border:none; padding:8px 20px; border-radius:6px; cursor:pointer;" onclick="this.parentElement.remove()">á›á»á”á…áŸá‰</button>
                    <div class="cert-container-resizer">
                        <div class="cert-wrapper">
                            <div class="cert-paper" data-name="${name}">
                                <div class="frame-2">
                                    <div class="frame-3">
                                        <div class="cert-content">
                                            <div style="text-align:center;">
                                                <h1 class="cert-title">CERTIFICATE</h1>
                                                <div class="deco-txt">OF EXCELLENCE</div>
                                            </div>
                                            <div style="text-align:center;">
                                                <p style="font-size:28px; color:#666; margin:0; font-style:italic;">This Certificate is Proudly Presented to</p>
                                                <div class="student-name" style="font-size:${name.length > 20 ? '65px' : '95px'};">${name}</div>
                                            </div>
                                            <div class="desc">${desc}</div>
                                            <div class="footer">
                                                <div class="sign-block">
                                                    <div class="sign-name">${man}</div>
                                                    <div class="line"></div>
                                                    <div class="sign-label">SIGNATURE</div>
                                                </div>
                                                <div class="sign-block">
                                                    <div class="sign-name">${date}</div>
                                                    <div class="line"></div>
                                                    <div class="sign-label">DATE</div>
                                                </div>
                                            </div>
                                            <img src="https://cdn-icons-png.flaticon.com/512/610/610333.png" class="seal">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;
            document.getElementById('certList').insertAdjacentHTML('afterbegin', html);
            if(window.innerWidth < 1000) toggleMenu();
        }

        async function downloadAll() {
            const certs = document.querySelectorAll('.cert-paper');
            if (certs.length === 0) return;
            const btn = document.getElementById('dlBtn');
            btn.innerText = "â³ á€áŸ†á–á»á„áŠáŸ†áá¾ášá€á¶áš...";
            btn.disabled = true;
            
            for (let c of certs) {
                // á”á„áŸ’ááŸ†á±áŸ’á™ Browser load font á±áŸ’á™ášá½á…ášá¶á›áŸ‹
                await document.fonts.ready;
                
                const canvas = await html2canvas(c, { 
                    scale: 3, // á”á„áŸ’á€á¾á“á€á˜áŸ’ášá·áá…áŸ’á”á¶áŸáŸ‹
                    useCORS: true,
                    windowWidth: 1200, // á”á„áŸ’ááŸ†á‘áŸ†á áŸ† Browser á“á·á˜áŸ’á˜á·áá±áŸ’á™á’áŸ†áŠá¾á˜áŸ’á”á¸á€á»áŸ†á±áŸ’á™á¢á€áŸ’áŸášáœáŸá‰
                    logging: false,
                    backgroundColor: null,
                    scrollX: 0,
                    scrollY: -window.scrollY
                });
                
                const link = document.createElement('a');
                link.download = `Cert_${c.getAttribute('data-name').replace(/\s+/g, '_')}.png`;
                link.href = canvas.toDataURL("image/png", 1.0);
                link.click();
            }
            btn.innerText = "á‘á¶á‰á™á€á‘á¶áŸ†á„á¢áŸáŸ‹ (HD PNG)";
            btn.disabled = false;
        }

        window.onload = () => { loadData(); addNewCert(); };
    </script>
</body>
</html>
